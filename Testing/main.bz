link "raylib"
link "gdi32"
link "winmm"

cfn printf(byte[] fmt, *) i32

type color {
    byte r,
    byte g,
    byte b,
    byte a
}

type texture {
    i32 id,
    i32 width,
    i32 height,
    i32 mipmaps,
    i32 format
}

type rectangle {
    float x,
    float y,
    float width,
    float height
}

type vec2 {
    float x,
    float y
}

type cell {
    byte number,
    bool closed,
    bool mine,
    bool flag,
}

cfn InitWindow(int w, int h, byte[] title)
cfn WindowShouldClose() bool
cfn BeginDrawing()
cfn EndDrawing()
cfn ClearBackground(color c)
cfn SetTargetFPS(int fps)

cfn LoadTexture(byte[] path) texture
cfn LoadImage(byte[] path) i32
cfn DrawTextureRec(texture t, rectangle r, vec2 pos, color c)
cfn DrawTexturePro(texture t, rectangle sr, rectangle dr, vec2 pos, float rot, color c)
cfn GetWorkingDirectory() void@
cfn InitAudioDevice()

cfn strlen(byte[]) i32

fn main() {
    call InitWindow(800, 450, "Minesweeper")

    let color bg = color!{ 200, 200, 200, 255 }

    let texture closed = LoadTexture("assets/rescaled/closed.png")

    let texture opened = LoadTexture("assets/rescaled/opened.png")
    let texture _1 = LoadTexture("assets/rescaled/1.png")
    let texture _2 = LoadTexture("assets/rescaled/2.png")
    let texture _3 = LoadTexture("assets/rescaled/3.png")
    let texture _4 = LoadTexture("assets/rescaled/4.png")
    let texture _5 = LoadTexture("assets/rescaled/5.png")
    let texture _6 = LoadTexture("assets/rescaled/6.png")
    let texture _7 = LoadTexture("assets/rescaled/7.png")
    let texture _8 = LoadTexture("assets/rescaled/8.png")
    let texture[] numbers = [ opened, _1, _2, _3, _4, _5, _6, _7, _8 ]

    let rectangle tileSize = rectangle!{0,0,51,51}
    let vec2 offset = vec2!{0,0}
    let color tint = color!{255,255,255,255}

    let int gridWidth = 20
    let int gridHeight = 20
    let cell[][] grid = *gridWidth
    for i from 0 until grid.len {
        mut grid[i] = *gridHeight
        for j from 0 until grid[i].len {
            mut grid[i][j] = cell!{0,true,false,false}
            call printf("%d\n", j)
        }
    }

    call SetTargetFPS(60)

    while !WindowShouldClose() {
        call BeginDrawing()

            call ClearBackground(bg)

            for i from 0 until grid.len {
                let float x = tofloat(i)
                for j from 0 until grid[i].len {
                    let float y = tofloat(j)
                    call DrawTextureRec(_1, tileSize, vec2!{x, y}, tint)
                }
            }

        call EndDrawing()
    }
}

cfn tofloat(int) float
